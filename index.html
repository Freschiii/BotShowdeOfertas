<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show de Ofertas - Bot Manager</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body class="dark-mode">
    <div class="container">
        <header>
            <h1><i class="fas fa-robot"></i> Show de Ofertas Bot</h1>
            <p>Bot autom√°tico para WhatsApp e Telegram</p>
        <button onclick="testarWhatsApp()" style="background: #25d366; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px;">
            üîß Testar WhatsApp
        </button>
        
        <div id="qrCodeTerminalWarning" style="display: none; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; padding: 15px; margin: 20px; color: #856404;">
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <span style="font-size: 1.5rem; margin-right: 10px;">üì±</span>
                <strong>QR Code Gerado!</strong>
            </div>
            <p style="margin: 5px 0; font-size: 0.9rem;">
                <strong>‚ö†Ô∏è Importante:</strong> O QR Code foi gerado no terminal do servidor (console onde voc√™ rodou o comando).
            </p>
            <p style="margin: 5px 0; font-size: 0.9rem;">
                <strong>üì± Como conectar:</strong>
            </p>
            <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9rem;">
                <li>Verifique o terminal/console onde o servidor est√° rodando</li>
                <li>Voc√™ ver√° um QR Code ASCII l√°</li>
                <li>Abra o WhatsApp no seu celular</li>
                <li>Toque em "Dispositivos conectados" ‚Üí "Conectar um dispositivo"</li>
                <li>Escaneie o QR Code que aparece no terminal</li>
            </ul>
            <button onclick="document.getElementById('qrCodeTerminalWarning').style.display='none';" style="
                background: #ff6b35; 
                color: white; 
                border: none; 
                padding: 8px 15px; 
                border-radius: 5px; 
                cursor: pointer; 
                margin-top: 10px;
                font-size: 0.8rem;
            ">‚ùå Fechar</button>
        </div>
        </header>

        <main>
            <!-- Sistema de Abas -->
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab-button active" data-tab="main">
                        <i class="fas fa-home"></i> Principal
                    </button>
                    <button class="tab-button" data-tab="config">
                        <i class="fas fa-cog"></i> Configura√ß√µes
                    </button>
                </div>
            </div>

            <!-- Aba Principal -->
            <div id="main-tab" class="tab-content active">
                <!-- Status dos Bots -->
                <div class="card">
                    <h2><i class="fas fa-signal"></i> Status dos Bots</h2>
                <div class="bot-status">
                    <div class="status-item">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp Bot</span>
                        <div class="status-indicator" id="whatsappStatus">
                            <span class="status-dot offline"></span>
                            <span>Desconectado</span>
                        </div>
                    </div>
                    <div class="status-item">
                        <i class="fab fa-telegram"></i>
                        <span>Telegram Bot</span>
                        <div class="status-indicator" id="telegramStatus">
                            <span class="status-dot offline"></span>
                            <span>Desconectado</span>
                        </div>
                    </div>
                </div>
            </div>

            </div>

            <!-- Aba Configura√ß√µes -->
            <div id="config-tab" class="tab-content">
                <!-- Configura√ß√£o WhatsApp -->
                <div class="card">
                    <h2><i class="fab fa-whatsapp"></i> Configurar WhatsApp Bot</h2>
                    <div class="bot-config">
                        <button id="connectWhatsApp" class="btn-whatsapp">
                            <i class="fas fa-qrcode"></i> Conectar WhatsApp
                        </button>
                        <div id="whatsappQR" class="qr-container" style="display: none;">
                            <h3>Escaneie o QR Code com seu WhatsApp</h3>
                            <div id="qrCode"></div>
                            <p>1. Abra o WhatsApp no seu celular</p>
                            <p>2. V√° em Menu > Dispositivos conectados</p>
                            <p>3. Escaneie o QR Code acima</p>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√£o Telegram -->
                <div class="card">
                    <h2><i class="fab fa-telegram"></i> Configurar Telegram Bot</h2>
                    <div class="bot-config">
                        <div class="input-group">
                            <input type="text" id="telegramToken" placeholder="Token do Bot Telegram (obtenha com @BotFather)" />
                            <button id="connectTelegram" class="btn-telegram">
                                <i class="fas fa-link"></i> Conectar
                            </button>
                        </div>
                        <div class="help-text">
                            <p><strong>Como obter o token:</strong></p>
                            <p>1. Abra o Telegram e procure por @BotFather</p>
                            <p>2. Digite /newbot e siga as instru√ß√µes</p>
                            <p>3. Copie o token gerado e cole acima</p>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√£o de Canais -->
                <div class="card">
                    <h2><i class="fas fa-broadcast-tower"></i> Configurar Canais</h2>
                    <div class="group-config">
                        <div class="input-group">
                            <label>Canal WhatsApp:</label>
                            <input type="text" id="whatsappGroup" placeholder="Nome do canal ou ID" />
                        </div>
                        <div class="input-group">
                            <label>Canal Telegram:</label>
                            <input type="text" id="telegramGroup" placeholder="ID do canal (ex: -1001234567890)" />
                        </div>
                        <button id="saveGroups" class="btn-primary">
                            <i class="fas fa-save"></i> Salvar Canais
                        </button>
                        <div id="autoSaveIndicator" class="auto-save-indicator" style="display: none;">
                            <i class="fas fa-check-circle"></i> Dados salvos automaticamente
                        </div>
                    </div>
                </div>

                <!-- Descobrir IDs dos Canais -->
                <div class="card">
                    <h2><i class="fas fa-search"></i> Descobrir IDs dos Canais</h2>
                    <div id="discoveryInterface"></div>
                </div>
            </div>

            <!-- Envio de Mensagens -->
            <div class="card">
                <h2><i class="fas fa-paper-plane"></i> Enviar Mensagem</h2>
                <div class="message-sender">
                    <div class="send-options">
                        <label>
                            <input type="checkbox" id="sendToWhatsApp" checked>
                            <i class="fab fa-whatsapp"></i> Enviar para WhatsApp
                        </label>
                        <label>
                            <input type="checkbox" id="sendToTelegram" checked>
                            <i class="fab fa-telegram"></i> Enviar para Telegram
                        </label>
                    </div>
                    
                    <!-- WhatsApp Preview/Editor -->
                    <div class="whatsapp-preview">
                        <div class="whatsapp-chat">
                            <div class="whatsapp-header">
                                <div class="whatsapp-contact">
                                    <div class="whatsapp-avatar"></div>
                                    <div class="whatsapp-info">
                                        <div class="whatsapp-name">Canal de Ofertas</div>
                                        <div class="whatsapp-status">online</div>
                                    </div>
                                </div>
                            </div>
                            <div class="whatsapp-messages" id="whatsappPreview">
                                <div class="whatsapp-message received editable-message" id="editableMessage">
                                    <div class="message-content">
                                        <div class="message-text" contenteditable="true" id="messageTextInput" placeholder="Digite sua mensagem aqui...">Digite sua mensagem aqui...</div>
                                    </div>
                                    <div class="message-time">Agora</div>
                                </div>
                            </div>
                            <!-- Controles da Mensagem -->
                            <div class="whatsapp-controls">
                                <div class="whatsapp-controls-row">
                                    <button class="whatsapp-control-btn" id="whatsappAttachBtn" title="Adicionar Imagem">
                                        <i class="fas fa-image"></i>
                                    </button>
                                    <input type="file" id="whatsappImageInput" accept="image/*" style="display: none;" />
                                    
                                    <button class="whatsapp-control-btn" id="whatsappScheduleBtn" title="Agendar Mensagem">
                                        <i class="fas fa-clock"></i>
                                    </button>
                                    
                                    <button class="whatsapp-control-btn" id="whatsappAddBtn" title="Adicionar Mensagem">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    
                                    <button class="whatsapp-control-btn" onclick="testarInput()" title="Testar Input" style="background: #ff6b6b;">
                                        <i class="fas fa-bug"></i>
                                    </button>
                                    
                                    <button class="whatsapp-control-btn whatsapp-delete-btn" id="whatsappDeleteBtn" title="Deletar Mensagem" style="display: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                
                                <!-- √Årea de Agendamento -->
                                <div class="whatsapp-schedule-area" id="whatsappScheduleArea" style="display: none;">
                                    <div class="schedule-container">
                                        <div class="schedule-header">
                                            <div class="schedule-title">
                                                <i class="fas fa-clock"></i>
                                                <span>Agendar Mensagem</span>
                                            </div>
                                            <button class="schedule-reset-icon" id="whatsappScheduleResetBtn" title="Resetar Agendamento">
                                                <i class="fas fa-undo"></i>
                                            </button>
                                        </div>
                                        <div class="schedule-inputs">
                                            <div class="date-input-group">
                                                <label for="schedule-date-main">Quando:</label>
                                                <select id="schedule-date-main" class="schedule-date-select">
                                                    <option value="today">Hoje</option>
                                                    <option value="tomorrow">Amanh√£</option>
                                                </select>
                                            </div>
                                            <div class="time-input-group">
                                                <label for="schedule-time-main">Hor√°rio:</label>
                                                <input type="time" id="schedule-time-main" class="schedule-time-input" />
                                            </div>
                                        </div>
                                        <div class="schedule-actions">
                                            <button class="schedule-confirm-btn" id="whatsappScheduleConfirmBtn">
                                                <i class="fas fa-check"></i>
                                                <span>Confirmar</span>
                                            </button>
                                            <button class="schedule-cancel-btn" id="whatsappScheduleCancelBtn">
                                                <i class="fas fa-times"></i>
                                                <span>Cancelar</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√£o de Enviar Separado -->
                    <div class="send-button-container">
                        <div class="message-counter" id="messageCounter" style="display: none;">
                            <span class="counter-text">1 mensagem</span>
                        </div>
                        <button id="sendMessage" class="btn-send">
                            <i class="fas fa-paper-plane"></i> 
                            <span class="btn-text">Enviar Mensagens</span>
                            <div class="btn-shine"></div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Hist√≥rico de Mensagens -->
            <div class="card">
                <h2><i class="fas fa-history"></i> Hist√≥rico de Envios</h2>
                <div id="messageHistory" class="message-history">
                    <p class="empty-history">Nenhuma mensagem enviada ainda</p>
                </div>
            </div>
        </main>

        <footer>
            <p>Feito com ‚ù§Ô∏è para ajudar no Show de Ofertas</p>
        </footer>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="bot.js"></script>
    <script src="discover-ids.js"></script>
    <script src="script.js"></script>
</body>
</html>